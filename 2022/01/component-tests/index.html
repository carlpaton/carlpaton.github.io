<!DOCTYPE html>
<html>
<head>
  <meta name="google-adsense-account" content="ca-pub-2204075991179473">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2204075991179473"
     crossorigin="anonymous"></script>  
  <script src="https://analytics.ahrefs.com/analytics.js" data-key="TN0ONB+Rzh+WjWrC8wjyqg" async></script>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-117029737-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Component Tests With Collection &amp; Class Fixtures | Carl Paton | There are no silly questions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="A component test verifies the functionality of individual components within an application by isolating and testing them in a controlled environment.   Common techniques used in C# component tests ar">
<meta property="og:type" content="article">
<meta property="og:title" content="Component Tests With Collection &amp; Class Fixtures">
<meta property="og:url" content="https://carlpaton.github.io/2022/01/component-tests/index.html">
<meta property="og:site_name" content="There are no silly questions">
<meta property="og:description" content="A component test verifies the functionality of individual components within an application by isolating and testing them in a controlled environment.   Common techniques used in C# component tests ar">
<meta property="og:locale">
<meta property="og:image" content="https://carlpaton.github.io/d/component-tests/unit-boundaries.png">
<meta property="article:published_time" content="2022-01-30T11:00:00.000Z">
<meta property="article:modified_time" content="2024-08-30T01:23:48.512Z">
<meta property="article:author" content="Carl Paton">
<meta property="article:tag" content="software testing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://carlpaton.github.io/d/component-tests/unit-boundaries.png">
  
    <link rel="alternate" href="/atom.xml" title="There are no silly questions" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <nav id="mobile-nav">
  
    <a href="/about/" class="mobile-nav-link">About and Contact</a>
  
    <a href="/tags/aws/" class="mobile-nav-link">AWS</a>
  
    <a href="/tags/c/" class="mobile-nav-link">C#</a>
  
    <a href="/tags/docker/" class="mobile-nav-link">Docker</a>
  
    <a href="/2020/02/design-patterns/" class="mobile-nav-link">Design Patterns</a>
  
    <a href="/tags/learning-resources/" class="mobile-nav-link">Learning</a>
  
    <a href="/tags/patterns-principles/" class="mobile-nav-link">Patterns Principles</a>
  
</nav>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a class="main-nav-link" href="/" id="logo" title="There are no silly questions"
        >Carl Paton</a
      >

      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
        <a class="main-nav-link" href="/about/"
          >About and Contact</a
        >
        
        <a class="main-nav-link" href="/tags/aws/"
          >AWS</a
        >
        
        <a class="main-nav-link" href="/tags/c/"
          >C#</a
        >
        
        <a class="main-nav-link" href="/tags/docker/"
          >Docker</a
        >
        
        <a class="main-nav-link" href="/2020/02/design-patterns/"
          >Design Patterns</a
        >
        
        <a class="main-nav-link" href="/tags/learning-resources/"
          >Learning</a
        >
        
        <a class="main-nav-link" href="/tags/patterns-principles/"
          >Patterns Principles</a
        >
        
		<!--
        <a class="main-nav-link" href="/about/">About</a>
		-->
      </nav>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-component-tests" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/component-tests/" class="article-date">
  <time datetime="2022-01-30T11:00:00.000Z" itemprop="datePublished">2022-Jan</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Component Tests With Collection &amp; Class Fixtures
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>A component test verifies the functionality of individual components within an application by isolating and testing them in a controlled environment. </p>
</blockquote>
<p>Common techniques used in C# component tests are:</p>
<ul>
<li><a href="/tags/mocking/">Mocking and stubbing</a>: Creating simulated objects to replace dependencies and control their behavior.</li>
<li><a href="/2018/09/dependency-injection-frameworks/">Dependency injection</a>: Injecting dependencies into components to make them more testable.</li>
<li><a href="/2018/06/test-driven-development-tdd/">Test-driven development (TDD)</a>: Writing tests before writing the actual code, driving development in a test-first manner.</li>
</ul>
<p><img src="/d/component-tests/unit-boundaries.png" alt="Component tests dont crossing unit boundaries"></p>
<h1 id="Component-Test-example"><a href="#Component-Test-example" class="headerlink" title="Component Test example"></a>Component Test example</h1><p>Iâ€™ve worked in teams where <a href="/2022/01/integration-tests/">Integration Tests</a> are re-used, the external dependencies are mocked out with another appsettings file. This is in my opinion then a <code>Component Test</code>, so the two resources above <code>HTTP</code> and <code>Database</code> are mocked / stubbed.</p>
<p>The appsettings file could then be called something like <code>appsettings.Mock.json</code></p>
<h2 id="Using-a-fixture"><a href="#Using-a-fixture" class="headerlink" title="Using a fixture"></a>Using a fixture</h2><p>It makes sense to break the tests down but still group them by <code>Features</code> - these should be already grouped by your controllers. By design controllers are allowed to do too much, you can add as many endpoints in them as you like - thats a different topic, see <a target="_blank" rel="noopener" href="https://ardalis.com/mvc-controllers-are-dinosaurs-embrace-api-endpoints/">MVC Controllers are Dinosaurs - Embrace API Endpoints</a>. For my features examples however grouping responsability makes component testing by feature easier.</p>
<p>Consider these controllers, <code>Artists</code> has simple <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Glossary/CRUD">CRUD</a> operations and so does <code>Songs</code>, these operations are abstracted away and then <a href="/2018/04/dependency-inversion-principle-dip/">injected as an interface</a>, using the <code>Controllers</code> folder is simply following <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Convention_over_configuration">convention over configuration</a>.</p>
<p>I would understand this as one <code>Artist</code> has many <code>Songs</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Foo.Api/Controllers/ArtistsController.cs</span><br><span class="line">Foo.Api/Controllers/SongsController.cs</span><br></pre></td></tr></table></figure>

<p>The component tests could then be created as <code>Features/Artists</code> and <code>Features/Songs</code>, understandably there could be overlap if a Artist is persisted with some songs - ideally the link would just be the foreign key and not the whole implementation so <a href="/2020/11/what-makes-a-great-api/">design considerations need to thought out</a>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Foo.Api.ComponentTests/Features/Artists/</span><br><span class="line">Foo.Api.ComponentTests/Features/Songs/</span><br></pre></td></tr></table></figure>

<p>The abstractions the controller instantiates though <a href="/2018/09/dependency-injection-frameworks/">dependency injection</a> would still be injected by the applications framework, their behavior also doesnt change however the configuration (appsettings in .Net) can be changed by environment. This means the application needs to have the same <code>appsettings</code> values as the component tests.</p>
<h3 id="Collection-Fixtures"><a href="#Collection-Fixtures" class="headerlink" title="Collection Fixtures"></a>Collection Fixtures</h3><blockquote>
<p><strong>When to use</strong>: when you want to create a single test context and share it among tests in SEVERAL TEST CLASSES, and have it cleaned up after all the tests in the test classes have finished. - xunit.net/docs/shared-context</p>
</blockquote>
<p>Examples of data it could share </p>
<ul>
<li><code>Options</code> values (config) </li>
<li>Clients (classes that use HttpClient to call APIs)</li>
</ul>
<p>The tests can use something called a <code>Fixture</code> to instantiate their dependencys. One or more fixtures are then injected into our tests. So below the <code>CollectionFixture</code> is really a base class to share context between tests.</p>
<p>Example <code>Foo.Api.ComponentTests/Fixtures/CollectionFixture.cs</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> A base class for any tests that want to implement xunit&#x27;s ICollectionFixture functionality to share context between tests.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Test classes that use this fixture should be decorated with [Collection(&quot;Shared Collection Fixture&quot;)]</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CollectionFixture</span> : <span class="title">IAsyncLifetime</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> FooServiceClient _client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> FooBarOptions _fooBar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CollectionFixture</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> appSettings = <span class="string">&quot;appsettings.Mock.json&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (Environment.GetEnvironmentVariable(<span class="string">&quot;DOTNET_ENVIRONMENT&quot;</span>) == <span class="string">&quot;Uat&quot;</span>)</span><br><span class="line">            appSettings = <span class="string">&quot;appsettings.Uat.json&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> configuration = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">            .AddJsonFile(appSettings)</span><br><span class="line">            .Build();</span><br><span class="line"></span><br><span class="line">        _fooBar = configuration</span><br><span class="line">            .GetSection(FooBarOptions.FooBar)</span><br><span class="line">            .Get&lt;List&lt;FooBarOptions&gt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> FooServiceClient FooServiceClient</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_client != <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> _client;</span><br><span class="line"></span><br><span class="line">            _client = <span class="keyword">new</span> FooService(_fooBar);</span><br><span class="line">            <span class="keyword">return</span> _client;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... DisposeAsync, InitializeAsync</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We use <code>IAsyncLifetime</code> to call into the services to dispose of resources. If you use <code>InitializeAsync</code> here to seed any data you must remember its for all tests. If you want to seed data just for a subset then see <code>Class Fixtures</code> below.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">DisposeAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// clean up test data if the database was not brought up as part of the environment, ie: its not in a test container</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// dispose of clients</span></span><br><span class="line">    _client?.Dispose();</span><br><span class="line">    <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Task <span class="title">InitializeAsync</span>()</span> =&gt; Task.CompletedTask;</span><br></pre></td></tr></table></figure>

<p>To then allow the <code>CollectionFixture</code> to be instanciated and managed we need to create a <code>SharedCollectionFixture</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CollectionDefinition(<span class="string">&quot;Shared Collection Fixture&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SharedCollectionFixture</span> : <span class="title">ICollectionFixture</span>&lt;<span class="title">CollectionFixture</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// This class has no implementation as is never created. </span></span><br><span class="line">    <span class="comment">// Its purpose is simply to be the place to apply [CollectionDefinition] and all the ICollectionFixture&lt;&gt; interfaces.</span></span><br><span class="line">    <span class="comment">// See https://xunit.net/docs/shared-context    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Test classes that want to use <code>CollectionFixture</code> should be decorated with <code>[Collection(&quot;Shared Collection Fixture&quot;)]</code>. Their constructor parameters can then include <code>CollectionFixture collectionFixture</code>. The facts can then access <code>_collectionFixture.FooServiceClient</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Collection(<span class="string">&quot;Shared Collection Fixture&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ArtistTests</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> CollectionFixture _collectionFixture;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArtistTests</span>(<span class="params">CollectionFixture collectionFixture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _collectionFixture = collectionFixture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Fact</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">U_I_E</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Arrange</span></span><br><span class="line">        <span class="comment">// Act</span></span><br><span class="line">        <span class="comment">// Assert</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FooServiceClient"><a href="#FooServiceClient" class="headerlink" title="FooServiceClient"></a>FooServiceClient</h4><p>The <code>FooServiceClient</code> should inherit/implement <code>IDisposable</code> to dispose of any clients it may have. This is called from the fixtures <code>DisposeAsync</code> method to ensure all state is disposed of.</p>
<p><code> GC.SuppressFinalize(this)</code> will prevent derived types that introduce a finalizer from needing to re-implement IDisposable to call it. See <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca1816">CA1816: Call GC.SuppressFinalize correctly</a></p>
<p>Alternatively the client <code>FooServiceClient</code> could use the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/sealed">sealed keyword</a> to prevent inheritance.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooServiceClient</span> : <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HttpClient _client;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooServiceClient</span>(<span class="params">FooServiceOptions fooServiceOptions</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _client = <span class="keyword">new</span> HttpClient &#123; BaseAddress = <span class="keyword">new</span> Uri(fooServiceOptions.Url) &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ArtistDto&gt; <span class="title">GetArtistAsync</span>(<span class="params">Guid artistId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ... </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _client.Dispose();</span><br><span class="line">        GC.SuppressFinalize(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Class-Fixtures"><a href="#Class-Fixtures" class="headerlink" title="Class Fixtures"></a>Class Fixtures</h3><blockquote>
<p><strong>When to use</strong>: when you want to create a single test context and share it among all the tests ONE TEST CLASS, and have it cleaned up after all the tests in the class have finished. - xunit.net/docs/shared-context</p>
</blockquote>
<p>Examples of what it can do</p>
<ul>
<li>Seed data before each test, ie: call your API under test and seed data (this is more for an integration tests, it may not be sensible for component but I kept this point for completeness should you be reusing component as integration tests)</li>
<li>Provide IDs (often GUIDs) for the seeded data, you would then use this in your tests</li>
</ul>
<p>Create the fixture the same as above but it will not need the <code>CollectionDefinition</code> class.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> A base class for any tests that want to implement xunit&#x27;s IClassFixture functionality to share context between tests.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> This class should be inherited by a child class to be used with IClassFixture<span class="doctag">&lt;T&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindStuffFixture</span> : <span class="title">IAsyncLifetime</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ... private state</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Note that if you wanted to use the class fixture that provides for example test clients to do http calls you would just as for it in the class fixtures constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FindStuffFixture</span>(<span class="params">CollectionFixture collectionFixture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ... set private state</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">InitializeAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ... seed data using `collectionFixture` clients</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> tasks = <span class="keyword">new</span> List&lt;Task&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ... collection of tasks to run in parallel</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">await</span> Task.WhenAll(tasks);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... its sensible to still wait a 1 to 10 seconds</span></span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task <span class="title">DisposeAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ... cleanup if needed </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// then return</span></span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Create the tests and inherit/implement <code>IClassFixture&lt;T&gt;</code> and <code>IAsyncLifetime</code>.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindStuffTests</span> : <span class="title">IClassFixture</span>&lt;<span class="title">FindStuffFixture</span>&gt;, <span class="title">IAsyncLifetime</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FindStuffTests</span>(<span class="params">FindStuffFixture findStuffFixture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _findStuffFixture = findStuffFixture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Fact</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">U_I_E</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Arrange</span></span><br><span class="line">        <span class="comment">// Act</span></span><br><span class="line">        <span class="comment">// Assert</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Collection-Fixtures-And-Class-Fixtures-together"><a href="#Using-Collection-Fixtures-And-Class-Fixtures-together" class="headerlink" title="Using Collection Fixtures And Class Fixtures together"></a>Using Collection Fixtures And Class Fixtures together</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Collection(<span class="string">&quot;Shared Collection Fixture&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindStuffTests</span> : <span class="title">IClassFixture</span>&lt;<span class="title">FindStuffFixture</span>&gt;, <span class="title">IAsyncLifetime</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FindStuffTests</span>(<span class="params">CollectionFixture collectionFixture, FindStuffFixture findStuffFixture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _findStuffFixture = findStuffFixture;</span><br><span class="line">        _collectionFixture = collectionFixture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Fact</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">U_I_E</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Arrange</span></span><br><span class="line">        <span class="comment">// Act</span></span><br><span class="line">        <span class="comment">// Assert</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://xunit.net/docs/shared-context">xUnit.net: Shared Context between Tests</a></li>
<li><a target="_blank" rel="noopener" href="https://automationpanda.com/2017/10/19/in-bdd-what-should-be-a-feature/">In BDD what should be a feature</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://carlpaton.github.io/2022/01/component-tests/" data-id="cmejhngqg005t60ee3cml228i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software-testing/" rel="tag">software testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/02/sonatype-oss-index/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Sonatype OSS Index
        
      </div>
    </a>
  
  
    <a href="/2022/01/integration-tests/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Integration Tests</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap" class="widget-wrap">
  <div id="site_search">
    <h3 class="widget-title">Search</h3>
    <input
      type="text"
      id="local-search-input"
      name="q"
      results="0"
      placeholder="Search..."
      class="form-control"
    />
    <div id="local-search-result"></div>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/08/free-online-retro-games/">Free Online Retro Games</a>
          </li>
        
          <li>
            <a href="/2025/08/kiri-moto-operations-level/">Kiri Moto Level Operation</a>
          </li>
        
          <li>
            <a href="/2025/08/kiri-moto-operations/">Kiri Moto Operations</a>
          </li>
        
          <li>
            <a href="/2025/08/using-ai-models-in-vs-code/">Using AI Models In VS Code</a>
          </li>
        
          <li>
            <a href="/2025/08/mysql-with-ef-core/">MySQL with Entity Framework Core</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/net-library/" style="font-size: 11.3px;">.net library</a> <a href="/tags/3d-printing/" style="font-size: 10.87px;">3d printing</a> <a href="/tags/agile/" style="font-size: 10.43px;">agile</a> <a href="/tags/ai/" style="font-size: 10px;">ai</a> <a href="/tags/algorithms/" style="font-size: 11.74px;">algorithms</a> <a href="/tags/angular/" style="font-size: 14.78px;">angular</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/anti-pattern/" style="font-size: 10px;">anti pattern</a> <a href="/tags/architecture/" style="font-size: 15.65px;">architecture</a> <a href="/tags/arduino/" style="font-size: 10.43px;">arduino</a> <a href="/tags/asp-net/" style="font-size: 10.43px;">asp.net</a> <a href="/tags/assembly/" style="font-size: 10.87px;">assembly</a> <a href="/tags/auth/" style="font-size: 14.35px;">auth</a> <a href="/tags/aws/" style="font-size: 17.83px;">aws</a> <a href="/tags/azure/" style="font-size: 11.3px;">azure</a> <a href="/tags/beer/" style="font-size: 10px;">beer</a> <a href="/tags/behavioural-patterns/" style="font-size: 14.35px;">behavioural patterns</a> <a href="/tags/benchmarks/" style="font-size: 10.43px;">benchmarks</a> <a href="/tags/board-games/" style="font-size: 10px;">board games</a> <a href="/tags/browser-utilities/" style="font-size: 10.43px;">browser utilities</a> <a href="/tags/c/" style="font-size: 20px;">c#</a> <a href="/tags/cad/" style="font-size: 11.74px;">cad</a> <a href="/tags/cam/" style="font-size: 11.74px;">cam</a> <a href="/tags/client-side/" style="font-size: 11.3px;">client side</a> <a href="/tags/cloud-events/" style="font-size: 10.43px;">cloud events</a> <a href="/tags/cnc/" style="font-size: 15.22px;">cnc</a> <a href="/tags/continuous-integration/" style="font-size: 10.43px;">continuous integration</a> <a href="/tags/creational-patterns/" style="font-size: 11.3px;">creational patterns</a> <a href="/tags/cryptography/" style="font-size: 11.74px;">cryptography</a> <a href="/tags/css/" style="font-size: 11.74px;">css</a> <a href="/tags/csv/" style="font-size: 10px;">csv</a> <a href="/tags/dapper/" style="font-size: 10px;">dapper</a> <a href="/tags/data-structures/" style="font-size: 11.74px;">data structures</a> <a href="/tags/ddd/" style="font-size: 10.87px;">ddd</a> <a href="/tags/dependency-injection/" style="font-size: 13.04px;">dependency injection</a> <a href="/tags/design/" style="font-size: 10px;">design</a> <a href="/tags/dirt-bike/" style="font-size: 10.43px;">dirt bike</a> <a href="/tags/dns/" style="font-size: 10px;">dns</a> <a href="/tags/docker/" style="font-size: 17.39px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 10.87px;">docker compose</a> <a href="/tags/dynamics-business-central/" style="font-size: 10px;">dynamics business central</a> <a href="/tags/elk-stack/" style="font-size: 10px;">elk stack</a> <a href="/tags/entra/" style="font-size: 10.43px;">entra</a> <a href="/tags/feature-management/" style="font-size: 10.87px;">feature management</a> <a href="/tags/filters/" style="font-size: 10px;">filters</a> <a href="/tags/food/" style="font-size: 12.61px;">food</a> <a href="/tags/games/" style="font-size: 10.43px;">games</a> <a href="/tags/git/" style="font-size: 12.17px;">git</a> <a href="/tags/health-checks/" style="font-size: 10.87px;">health checks</a> <a href="/tags/hexo/" style="font-size: 10.43px;">hexo</a> <a href="/tags/ide/" style="font-size: 12.17px;">ide</a> <a href="/tags/indymill/" style="font-size: 11.74px;">indymill</a> <a href="/tags/infrastructure-as-code/" style="font-size: 13.48px;">infrastructure as code</a> <a href="/tags/iot/" style="font-size: 13.48px;">iot</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 13.48px;">javascript</a> <a href="/tags/jquery/" style="font-size: 10.87px;">jquery</a> <a href="/tags/json/" style="font-size: 11.74px;">json</a> <a href="/tags/kibana/" style="font-size: 10.43px;">kibana</a> <a href="/tags/kubernetes/" style="font-size: 10.43px;">kubernetes</a> <a href="/tags/learning-resources/" style="font-size: 13.48px;">learning resources</a> <a href="/tags/life-hacks/" style="font-size: 11.74px;">life-hacks</a> <a href="/tags/linux/" style="font-size: 11.74px;">linux</a> <a href="/tags/llm/" style="font-size: 10px;">llm</a> <a href="/tags/logging/" style="font-size: 11.3px;">logging</a> <a href="/tags/mocking/" style="font-size: 13.91px;">mocking</a> <a href="/tags/model-airplanes/" style="font-size: 18.26px;">model airplanes</a> <a href="/tags/mvc/" style="font-size: 13.04px;">mvc</a> <a href="/tags/mysql/" style="font-size: 11.3px;">mysql</a> <a href="/tags/net-core/" style="font-size: 11.74px;">net core</a> <a href="/tags/newrelic/" style="font-size: 10.43px;">newrelic</a> <a href="/tags/nginx/" style="font-size: 10.87px;">nginx</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/nuget/" style="font-size: 11.3px;">nuget</a> <a href="/tags/onshape/" style="font-size: 10.87px;">onshape</a> <a href="/tags/open-source/" style="font-size: 10px;">open source</a> <a href="/tags/orm/" style="font-size: 12.61px;">orm</a> <a href="/tags/patterns-principles/" style="font-size: 19.57px;">patterns principles</a> <a href="/tags/postgresql/" style="font-size: 11.3px;">postgresql</a> <a href="/tags/power-shell/" style="font-size: 10px;">power shell</a> <a href="/tags/python/" style="font-size: 13.04px;">python</a> <a href="/tags/random/" style="font-size: 11.74px;">random</a> <a href="/tags/raspberry-pi/" style="font-size: 16.96px;">raspberry pi</a> <a href="/tags/reactjs/" style="font-size: 17.83px;">reactjs</a> <a href="/tags/reactjs-class-based/" style="font-size: 10.43px;">reactjs class-based</a> <a href="/tags/redis/" style="font-size: 10.43px;">redis</a> <a href="/tags/reporting/" style="font-size: 11.74px;">reporting</a> <a href="/tags/rosetta-code/" style="font-size: 15.22px;">rosetta code</a> <a href="/tags/serialization/" style="font-size: 12.61px;">serialization</a> <a href="/tags/software-testing/" style="font-size: 18.7px;">software testing</a> <a href="/tags/sonarqube/" style="font-size: 10.43px;">sonarqube</a> <a href="/tags/sql/" style="font-size: 16.52px;">sql</a> <a href="/tags/sqlite/" style="font-size: 10.43px;">sqlite</a> <a href="/tags/ssh/" style="font-size: 10.87px;">ssh</a> <a href="/tags/static-code-analysis/" style="font-size: 11.3px;">static code analysis</a> <a href="/tags/structural-patterns/" style="font-size: 13.48px;">structural patterns</a> <a href="/tags/sumologic/" style="font-size: 10px;">sumologic</a> <a href="/tags/swagger/" style="font-size: 10.43px;">swagger</a> <a href="/tags/terraform/" style="font-size: 10.43px;">terraform</a> <a href="/tags/threading/" style="font-size: 10px;">threading</a> <a href="/tags/typescript/" style="font-size: 13.04px;">typescript</a> <a href="/tags/utilities/" style="font-size: 19.13px;">utilities</a> <a href="/tags/validation/" style="font-size: 10.43px;">validation</a> <a href="/tags/virtualization/" style="font-size: 10.43px;">virtualization</a> <a href="/tags/web-api/" style="font-size: 16.09px;">web api</a> <a href="/tags/web-forms/" style="font-size: 10px;">web forms</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/wip/" style="font-size: 18.7px;">wip</a> <a href="/tags/wood-work/" style="font-size: 10.87px;">wood work</a> <a href="/tags/wordpress/" style="font-size: 10px;">wordpress</a> <a href="/tags/workers/" style="font-size: 11.3px;">workers</a> <a href="/tags/xamarin/" style="font-size: 10px;">xamarin</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
    </div>
  </div>

  
</aside>
        
      </div>
    </div>
  </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 Carl Paton |
      Powered by <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>





  
<script src="/js/search.js"></script>

  <script type="text/javascript">
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    searchFunc(path, "local-search-input", "local-search-result");
  </script>

</body>
</html>