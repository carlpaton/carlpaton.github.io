<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-117029737-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>C# Sharp Timed Hosted Service | Carl Paton | There are no silly questions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is just a Hosted Service that runs with a timer, this means the task is run at intervals. For example every 60 seconds poll a service for changes. Hosted Service is a generic term Microsoft uses">
<meta property="og:type" content="article">
<meta property="og:title" content="C# Sharp Timed Hosted Service">
<meta property="og:url" content="https://carlpaton.github.io/2021/07/c-sharp-timed-hosted-service/index.html">
<meta property="og:site_name" content="There are no silly questions">
<meta property="og:description" content="This is just a Hosted Service that runs with a timer, this means the task is run at intervals. For example every 60 seconds poll a service for changes. Hosted Service is a generic term Microsoft uses">
<meta property="og:locale">
<meta property="og:image" content="https://carlpaton.github.io/d/c-sharp-timed-hosted-service/header.jpg">
<meta property="og:image" content="https://carlpaton.github.io/d/c-sharp-timed-hosted-service/timed-hosted-service-simple.jpg">
<meta property="article:published_time" content="2021-07-01T12:00:00.000Z">
<meta property="article:modified_time" content="2023-08-13T09:11:10.803Z">
<meta property="article:author" content="Carl Paton">
<meta property="article:tag" content="c#">
<meta property="article:tag" content="workers">
<meta property="article:tag" content="rosetta code">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://carlpaton.github.io/d/c-sharp-timed-hosted-service/header.jpg">
  
    <link rel="alternate" href="/atom.xml" title="There are no silly questions" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <nav id="mobile-nav">
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
    <a href="/tags/aws/" class="mobile-nav-link">AWS</a>
  
    <a href="/tags/c/" class="mobile-nav-link">C#</a>
  
    <a href="/tags/docker/" class="mobile-nav-link">Docker</a>
  
    <a href="/2020/02/design-patterns/" class="mobile-nav-link">Design Patterns</a>
  
    <a href="/tags/learning-resources/" class="mobile-nav-link">Learning</a>
  
    <a href="/tags/patterns-principles/" class="mobile-nav-link">Patterns Principles</a>
  
</nav>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a class="main-nav-link" href="/" id="logo" title="There are no silly questions"
        >Carl Paton</a
      >

      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
        <a class="main-nav-link" href="/about/"
          >About</a
        >
        
        <a class="main-nav-link" href="/tags/aws/"
          >AWS</a
        >
        
        <a class="main-nav-link" href="/tags/c/"
          >C#</a
        >
        
        <a class="main-nav-link" href="/tags/docker/"
          >Docker</a
        >
        
        <a class="main-nav-link" href="/2020/02/design-patterns/"
          >Design Patterns</a
        >
        
        <a class="main-nav-link" href="/tags/learning-resources/"
          >Learning</a
        >
        
        <a class="main-nav-link" href="/tags/patterns-principles/"
          >Patterns Principles</a
        >
        
		<!--
        <a class="main-nav-link" href="/about/">About</a>
		-->
      </nav>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-c-sharp-timed-hosted-service" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/c-sharp-timed-hosted-service/" class="article-date">
  <time datetime="2021-07-01T12:00:00.000Z" itemprop="datePublished">2021-Jul</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      C# Sharp Timed Hosted Service
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/d/c-sharp-timed-hosted-service/header.jpg" alt="Sharp Timed Hosted Service"></p>
<p>This is just a <a href="/2021/03/c-sharp-hosted-service/">Hosted Service</a> that runs with a <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.timers.timer">timer</a>, this means the task is run at intervals. For example every 60 seconds poll a service for changes. <code>Hosted Service</code> is a generic term Microsoft uses as they state ‚ÄúHosted Services are services/logic that you host within your host/application/microservice.‚Äù The Microsoft project template for this is <a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/premier-developer/demystifying-the-new-net-core-3-worker-service/">Worker Service</a> (using the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&tabs=visual-studio#backgroundservice-base-class-1">BackgroundService</a> base class) and other common names I‚Äôve seen are <code>Bots</code>, <code>Worker Processes</code>, <code>Workers</code> and my personal favorite <code>Daemon</code> üòà</p>
<blockquote>
<p>non-HTTP workloads like messaging, background tasks, console applications etc. These types of applications don‚Äôt have the notion of an incoming HTTP request like a traditional ASP.NET/ASP.NET Core Web Application - docs.microsoft.com</p>
</blockquote>
<h1 id="Story"><a href="#Story" class="headerlink" title="Story"></a>Story</h1><p>Consider the following events feed for a shopping cart below. These events are CRUD actions <code>CART_CREATE</code>, <code>CART_UPDATE</code> and <code>CART_DELETE</code>. The following query string parameters are used from the <a target="_blank" rel="noopener" href="https://github.com/typicode/json-server">json-server</a> instance.</p>
<ul>
<li>The watermark is set with <code>id_gte=42</code> this means where <code>events.id</code> &gt;= 42</li>
<li>Pagination is set with <code>_page=3</code> this means only show page 3</li>
<li>Set the page size with <code>_limit=25</code> this means the page size is 25, ie: the max <code>events</code> count will be 25</li>
</ul>
<table>
<thead>
<tr>
<th>Verb</th>
<th>URI example</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td><a target="_blank" rel="noopener" href="http://localhost:3331/events?id_gte=42&amp;_page=3&amp;_limit=25">http://localhost:3331/events?id_gte=42&amp;_page=3&amp;_limit=25</a></td>
</tr>
</tbody></table>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">42</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;event_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CART_CREATE&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;985e732f-bf00-4999-a1b6-873973f9b8ff&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;date_utc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-09-08T04:56:19Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0760c3e1-1ceb-4a00-aede-328c66f729c7&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;quantity&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;unit_cost&quot;</span><span class="punctuation">:</span> <span class="number">1.99</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;117e986e-c08f-4483-8a8f-d5e1c0512650&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;quantity&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;unit_cost&quot;</span><span class="punctuation">:</span> <span class="number">0.29</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">43</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;event_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CART_UPDATE&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;61af172f-ec9e-4789-848c-9a2bf3f16ba3&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;date_utc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-09-08T04:59:30Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;f4e0cc62-5be9-4ecc-82b4-4c90968a293c&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;quantity&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;unit_cost&quot;</span><span class="punctuation">:</span> <span class="number">3.25</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">45</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;event_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CART_DELETE&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5d9e7c82-0341-4d1c-aba4-f62789d77e6f&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h1><p>Create a hosted service that fulfills the following acceptance criteria:</p>
<ul>
<li>consumes this feed and persists the CRUD event to a database as a <code>CREATE</code>, <code>UPDATE</code> or <code>DELETE</code></li>
<li>a <code>watermark</code> needs to be used so events are not processed again</li>
<li>use <code>page</code> and <code>size</code> parameters</li>
<li>the service should run infinitely until the process is interupted with <code>ctrl+c</code></li>
<li>the solution should be extensible</li>
</ul>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>This is the simplest no frills solution, from here it could be adapted to inlude message queues and better separation of concerns. The code for this solution can be found at <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo">https://github.com/carlpaton/TimedHostedServiceDemo</a></p>
<p><img src="/d/c-sharp-timed-hosted-service/timed-hosted-service-simple.jpg" alt="Timed Hosted Service Simple"></p>
<h2 id="TimedHostedService-Worker"><a href="#TimedHostedService-Worker" class="headerlink" title="TimedHostedService.Worker"></a>TimedHostedService.Worker</h2><ol>
<li><p>Create a <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&tabs=visual-studio#timed-background-tasks">timed background task per the Microsoft documentation</a> using the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.ihostedservice">IHostedService</a> interface. Note that the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&tabs=visual-studio#backgroundservice-base-class">BackgroundService</a> is a base class for implementing a long running IHostedService. So this would work but I‚Äôve use the interface instead as that the example for a time hosted service at <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&tabs=visual-studio#timed-background-tasks">docs.microsoft.com</a>.</p>
</li>
<li><p>In Program.cs use <code>HostBuilder</code> to configure the startup pipeline. Use <code>ConfigureServices</code> to register <code>TimedHostedService</code> with <code>AddHostedService</code>. Additionally add console logging with <code>ConfigureLogging</code> and configuration with <code>ConfigureAppConfiguration</code></p>
</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TimedHostedService</span> : <span class="title">IHostedService</span>, <span class="title">IDisposable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;TimedHostedService&gt; _logger;</span><br><span class="line">    <span class="keyword">private</span> Timer _timer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimedHostedService</span>(<span class="params">ILogger&lt;TimedHostedService&gt; logger</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task <span class="title">StartAsync</span>(<span class="params">CancellationToken stoppingToken</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _logger.LogInformation(<span class="string">&quot;STARTASYNC RUN&quot;</span>);</span><br><span class="line">        _timer = <span class="keyword">new</span> Timer(DoWork, <span class="literal">null</span>, TimeSpan.Zero, TimeSpan.FromSeconds(<span class="number">42</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task <span class="title">StopAsync</span>(<span class="params">CancellationToken stoppingToken</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _logger.LogInformation(<span class="string">&quot;STOPASYNC RUN&quot;</span>);</span><br><span class="line">        _timer?.Change(Timeout.Infinite, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _timer?.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DoWork</span>(<span class="params"><span class="built_in">object</span> state</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _logger.LogInformation(<span class="string">$&quot;EVENT BROKER RUNS AGAIN IN 42 SECONDS.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Running the app now produces a timed event every 42 seconds and this is shown in the logs until <code>ctrl+c</code> is pressed. </li>
</ol>
<p>Beauty!</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">info: TimedHostedService.Worker.TimedHostedService[0]</span><br><span class="line">      STARTASYNC RUN</span><br><span class="line">info: TimedHostedService.Worker.TimedHostedService[0]</span><br><span class="line">      EVENT BROKER RUNS AGAIN IN 42 SECONDS.</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/ddd-oriented-microservice">Design a DDD-oriented microservice</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&tabs=visual-studio#timed-background-tasks">Timed background tasks</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/domain-events-design-implementation#implement-domain-events">Implement domain events</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/multi-container-microservice-net-applications/background-tasks-with-ihostedservice">Implement background tasks in microservices with IHostedService and the BackgroundService class</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&tabs=visual-studio">Background tasks with hosted services in ASP.NET Core</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-5.0">.NET Generic Host in ASP.NET Core</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/worker-service">Application Insights for Worker Service applications (non-HTTP applications)</a></li>
</ul>
<h3 id="Alternative-to-Time-Hosted"><a href="#Alternative-to-Time-Hosted" class="headerlink" title="Alternative to Time Hosted"></a>Alternative to Time Hosted</h3><p>Instead of using a <code>Timer</code> its also acceptable to just use a loop that exits based on a <code>CancellationToken</code>, here its more common to then just use the <code>BackgroundService</code> base class and only override <code>ExecuteAsync</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Worker</span> : <span class="title">BackgroundService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">async</span> Task <span class="title">ExecuteAsync</span>(<span class="params">CancellationToken token</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (!token.IsCancellationRequested)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// worker things!</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="TimedHostedService-Worker-Domain"><a href="#TimedHostedService-Worker-Domain" class="headerlink" title="TimedHostedService.Worker.Domain"></a>TimedHostedService.Worker.Domain</h2><h3 id="Event-Broker-CartEvents"><a href="#Event-Broker-CartEvents" class="headerlink" title="Event Broker (CartEvents)"></a>Event Broker (CartEvents)</h3><p>This orchestrates the flow and doesnt have to be called a <code>Broker</code> could be <code>Processor</code> or anything that makes sense to your team. This will be called by DoWork in <code>TimedHostedService</code> and only needs one method <code>ProcessAsync</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/EventBroker.cs">EventBroker implementation of IEventBroker</a></li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">TimedHostedService.Worker.Domain.CartEvents</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEventBroker</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Orchestrates the following:</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> - Check watermark.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> - Collect new events from HTTP events feed.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> - Dispatch events.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function">Task <span class="title">ProcessAsync</span>()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Event-Feed-Service-Services"><a href="#Event-Feed-Service-Services" class="headerlink" title="Event Feed Service (Services)"></a>Event Feed Service (Services)</h3><p>This will create the <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/Services/EventDto.cs">DTO entities</a> based on the JSON events feed, tools like <a target="_blank" rel="noopener" href="https://json2csharp.com/">json2csharp.com</a> can help quickly generate these classes.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/Services/HttpEventFeedService.cs">HttpEventFeedService implementation of IEventFeedService</a>. I used the <code>Http</code> prefix as these events could be fetched by other implementations such as local config file.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">TimedHostedService.Worker.Domain.Services</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEventFeedService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Get a collection of events from the feed. </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;watermark&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        Task&lt;IEnumerable&lt;EventDto&gt;&gt; GetEventsAsync(<span class="built_in">long</span> watermark);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The domain events are used to explicitly implement side effects across multiple aggregates. In C#, a domain event is simply a data-holding structure or class, like a DTO.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/domain-events-design-implementation">Domain events: design and implementation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/domain-events-design-implementation#implement-domain-events">Implement domain events</a></li>
</ul>
<h3 id="Cart-Mapper-CartEvents-Mappers"><a href="#Cart-Mapper-CartEvents-Mappers" class="headerlink" title="Cart Mapper (CartEvents/Mappers)"></a>Cart Mapper (CartEvents/Mappers)</h3><p>We will need to map the <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/Services/EventDto.cs">EventDto</a> to the domain event <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/Events/CartEvent.cs">CartEvent</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/Mappers/CartMapper.cs">CartMapper implementation of ICartMapper</a>.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">TimedHostedService.Worker.Domain.CartEvents.Mappers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICartMapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Maps `EventDto` to domain event `CartEvent`</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;eventDtos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">IEnumerable&lt;CartEvent&gt; <span class="title">MapCartEvent</span>(<span class="params">IEnumerable&lt;EventDto&gt; eventDtos</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Maps `CartEvent` to domain model `Cart`</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;cartEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">Cart <span class="title">MapCart</span>(<span class="params">CartEvent cartEvent</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Our <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/Events/EventType.cs">EventType</a>‚Äòs are based on the feed.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> EventType</span><br><span class="line">&#123;</span><br><span class="line">    CART_CREATE = <span class="number">1</span>,</span><br><span class="line">    CART_UPDATE = <span class="number">2</span>,</span><br><span class="line">    CART_DELETE = <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Event-Handler-CartEvents-Events-Handlers"><a href="#Event-Handler-CartEvents-Events-Handlers" class="headerlink" title="Event Handler (CartEvents/Events/Handlers)"></a>Event Handler (CartEvents/Events/Handlers)</h3><p>To separate out the concearns we have handlers for each event type.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/Handlers/CartCreateEventHandler.cs">CartCreateEventHandler implementation of IEventHandler</a>.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/Handlers/EmailOnCartCreateEventHandler.cs">EmailOnCartCreateEventHandler implementation of ICartMapper</a> (this is just an example of the extensibility, it doesnt actually send emails - but it could)</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">TimedHostedService.Worker.Domain.CartEvents.Handlers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEventHandler</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Handles the given event based on the action type in the event.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;cartEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">Task <span class="title">HandleAsync</span>(<span class="params">CartEvent cartEvent</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Matches the handler from the injected collection based on EventType</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;eventType&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="built_in">bool</span> <span class="title">IsMatch</span>(<span class="params">EventType eventType</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="TimedHostedService-Worker-Infrastructure"><a href="#TimedHostedService-Worker-Infrastructure" class="headerlink" title="TimedHostedService.Worker.Infrastructure"></a>TimedHostedService.Worker.Infrastructure</h2><p>This has <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/tree/master/src/TimedHostedService.Worker.Infrastructure/Repositories">Repositories</a> for persistant storage of data and the interfaces are defined in <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/tree/master/src/TimedHostedService.Worker.Domain/Interfaces">TimedHostedService.Worker.Domain/Interfaces</a></p>
<p><code>ICartItemRepository</code> and <code>ICartRepository</code> are very simliar.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Infrastructure/Repositories/CartRepository.cs">ICartRepository implementation of ICartRepository</a>.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Infrastructure/Repositories/CartItemRepository.cs">CartItemRepository implementation of ICartItemRepository</a>.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">TimedHostedService.Worker.Domain.Interfaces</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICartItemRepository</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Insert a new cart_item row</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;cartItem&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="built_in">long</span> <span class="title">Add</span>(<span class="params">CartItem cartItem</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Updates the existing cart_item row</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;cartItem&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params">CartItem cartItem</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Deletes the cart_item row</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;cartItemId&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> cartItemId</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>IWatermarkRepository</code> is used to keep track of the watermark in a local .ini file.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Infrastructure/Repositories/WatermarkRepository.cs">WatermarkRepository implementation of IWatermarkRepository</a>.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">TimedHostedService.Worker.Domain.Interfaces</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IWatermarkRepository</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Selects the current watermark value</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Only items greater than or equal to this value will be requested from the event feed</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="built_in">long</span> <span class="title">Get</span>()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Sets the watermark to the given value</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;watermark&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"><span class="built_in">long</span> watermark</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At the start of each <code>ProcessAsync</code> in the <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/EventBroker.cs">EventBroker</a> the watermark is read from the ini file.</p>
<p>After each event is dispatched and awaited the watermark is updated with <code>+1</code>. This implementation of the watermark would NOT scale well if the hosted service was with muiltiple instances but this is fine for a POC.</p>
<p>Thats it, the hosted service would continue to poll for new events and handle them. When new events are needed they can be implemented with <a target="_blank" rel="noopener" href="https://github.com/carlpaton/TimedHostedServiceDemo/blob/master/src/TimedHostedService.Worker.Domain/CartEvents/Handlers/IEventHandler.cs">IEventHandler</a> and injected as part of the collection using <a href="/2018/04/dependency-inversion-principle-dip/">dependency injection</a>.</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/background-jobs">https://docs.microsoft.com/en-us/azure/architecture/best-practices/background-jobs</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://carlpaton.github.io/2021/07/c-sharp-timed-hosted-service/" data-id="cm17ifjcu004474uh40ocf83w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rosetta-code/" rel="tag">rosetta code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/workers/" rel="tag">workers</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/07/oauth2-delegation-token/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          OAuth2 - Delegation Token
        
      </div>
    </a>
  
  
    <a href="/2021/06/dacpac/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Data-tier Application Component Package (DACPAC)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap" class="widget-wrap">
  <div id="site_search">
    <h3 class="widget-title">Search</h3>
    <input
      type="text"
      id="local-search-input"
      name="q"
      results="0"
      placeholder="Search..."
      class="form-control"
    />
    <div id="local-search-result"></div>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/12/deploying-dotnet-applications-azure/">Deploying .NET Applications To Azure</a>
          </li>
        
          <li>
            <a href="/2024/12/flyway-database-migration-using-github-actions/">Flyway Database Migration Using Github Actions</a>
          </li>
        
          <li>
            <a href="/2024/11/flyway-database-migration/">Flyway Database Migration (Local Dev)</a>
          </li>
        
          <li>
            <a href="/2024/11/make/">Make</a>
          </li>
        
          <li>
            <a href="/2024/11/sumolgic_with_terraform/">Sumologic With Terraform</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/net-library/" style="font-size: 11.3px;">.net library</a> <a href="/tags/3d-printing/" style="font-size: 10.87px;">3d printing</a> <a href="/tags/agile/" style="font-size: 10.43px;">agile</a> <a href="/tags/algorithms/" style="font-size: 11.74px;">algorithms</a> <a href="/tags/angular/" style="font-size: 14.78px;">angular</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/anti-pattern/" style="font-size: 10px;">anti pattern</a> <a href="/tags/architecture/" style="font-size: 15.65px;">architecture</a> <a href="/tags/arduino/" style="font-size: 10.43px;">arduino</a> <a href="/tags/asp-net/" style="font-size: 10.43px;">asp.net</a> <a href="/tags/assembly/" style="font-size: 10.87px;">assembly</a> <a href="/tags/auth/" style="font-size: 14.35px;">auth</a> <a href="/tags/aws/" style="font-size: 16.96px;">aws</a> <a href="/tags/azure/" style="font-size: 10px;">azure</a> <a href="/tags/beer/" style="font-size: 10px;">beer</a> <a href="/tags/behavioural-patterns/" style="font-size: 14.35px;">behavioural patterns</a> <a href="/tags/board-games/" style="font-size: 10px;">board games</a> <a href="/tags/browser-utilities/" style="font-size: 10.43px;">browser utilities</a> <a href="/tags/c/" style="font-size: 20px;">c#</a> <a href="/tags/cad/" style="font-size: 11.3px;">cad</a> <a href="/tags/cam/" style="font-size: 10.87px;">cam</a> <a href="/tags/client-side/" style="font-size: 11.3px;">client side</a> <a href="/tags/cloud-events/" style="font-size: 10.43px;">cloud events</a> <a href="/tags/cnc/" style="font-size: 13.91px;">cnc</a> <a href="/tags/continuous-integration/" style="font-size: 10.43px;">continuous integration</a> <a href="/tags/creational-patterns/" style="font-size: 11.3px;">creational patterns</a> <a href="/tags/cryptography/" style="font-size: 10.87px;">cryptography</a> <a href="/tags/css/" style="font-size: 11.74px;">css</a> <a href="/tags/csv/" style="font-size: 10px;">csv</a> <a href="/tags/dapper/" style="font-size: 10px;">dapper</a> <a href="/tags/data-structures/" style="font-size: 11.74px;">data structures</a> <a href="/tags/ddd/" style="font-size: 10.87px;">ddd</a> <a href="/tags/dependency-injection/" style="font-size: 13.04px;">dependency injection</a> <a href="/tags/design/" style="font-size: 10px;">design</a> <a href="/tags/dirt-bike/" style="font-size: 10.43px;">dirt bike</a> <a href="/tags/docker/" style="font-size: 16.96px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 10.87px;">docker compose</a> <a href="/tags/elk-stack/" style="font-size: 10px;">elk stack</a> <a href="/tags/encryption/" style="font-size: 10.87px;">encryption</a> <a href="/tags/feature-management/" style="font-size: 10.87px;">feature management</a> <a href="/tags/filters/" style="font-size: 10px;">filters</a> <a href="/tags/food/" style="font-size: 12.61px;">food</a> <a href="/tags/git/" style="font-size: 12.17px;">git</a> <a href="/tags/health-checks/" style="font-size: 10.87px;">health checks</a> <a href="/tags/hexo/" style="font-size: 10.43px;">hexo</a> <a href="/tags/ide/" style="font-size: 11.74px;">ide</a> <a href="/tags/indymill/" style="font-size: 11.74px;">indymill</a> <a href="/tags/infrastructure-as-code/" style="font-size: 13.48px;">infrastructure as code</a> <a href="/tags/iot/" style="font-size: 13.48px;">iot</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 13.04px;">javascript</a> <a href="/tags/jquery/" style="font-size: 10.87px;">jquery</a> <a href="/tags/json/" style="font-size: 11.74px;">json</a> <a href="/tags/kibana/" style="font-size: 10.43px;">kibana</a> <a href="/tags/kubernetes/" style="font-size: 10.43px;">kubernetes</a> <a href="/tags/learning-resources/" style="font-size: 13.48px;">learning resources</a> <a href="/tags/life-hacks/" style="font-size: 11.74px;">life-hacks</a> <a href="/tags/linux/" style="font-size: 11.74px;">linux</a> <a href="/tags/logging/" style="font-size: 11.3px;">logging</a> <a href="/tags/mocking/" style="font-size: 13.91px;">mocking</a> <a href="/tags/model-airplanes/" style="font-size: 17.83px;">model airplanes</a> <a href="/tags/mvc/" style="font-size: 13.04px;">mvc</a> <a href="/tags/mysql/" style="font-size: 10.87px;">mysql</a> <a href="/tags/net-core/" style="font-size: 11.74px;">net core</a> <a href="/tags/newrelic/" style="font-size: 10.43px;">newrelic</a> <a href="/tags/nginx/" style="font-size: 10.87px;">nginx</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/nuget/" style="font-size: 11.3px;">nuget</a> <a href="/tags/open-source/" style="font-size: 10px;">open source</a> <a href="/tags/orm/" style="font-size: 12.17px;">orm</a> <a href="/tags/patterns-principles/" style="font-size: 19.57px;">patterns principles</a> <a href="/tags/postgresql/" style="font-size: 10.87px;">postgresql</a> <a href="/tags/power-shell/" style="font-size: 10px;">power shell</a> <a href="/tags/python/" style="font-size: 13.04px;">python</a> <a href="/tags/random/" style="font-size: 11.74px;">random</a> <a href="/tags/raspberry-pi/" style="font-size: 16.52px;">raspberry pi</a> <a href="/tags/reactjs/" style="font-size: 17.39px;">reactjs</a> <a href="/tags/reactjs-class-based/" style="font-size: 10.43px;">reactjs class-based</a> <a href="/tags/redis/" style="font-size: 10.43px;">redis</a> <a href="/tags/reporting/" style="font-size: 11.74px;">reporting</a> <a href="/tags/rosetta-code/" style="font-size: 15.22px;">rosetta code</a> <a href="/tags/serialization/" style="font-size: 12.61px;">serialization</a> <a href="/tags/software-testing/" style="font-size: 18.26px;">software testing</a> <a href="/tags/sonarqube/" style="font-size: 10.43px;">sonarqube</a> <a href="/tags/sql/" style="font-size: 16.09px;">sql</a> <a href="/tags/sqlite/" style="font-size: 10.43px;">sqlite</a> <a href="/tags/ssh/" style="font-size: 10.87px;">ssh</a> <a href="/tags/static-code-analysis/" style="font-size: 11.3px;">static code analysis</a> <a href="/tags/structural-patterns/" style="font-size: 13.48px;">structural patterns</a> <a href="/tags/sumologic/" style="font-size: 10px;">sumologic</a> <a href="/tags/swagger/" style="font-size: 10.43px;">swagger</a> <a href="/tags/terraform/" style="font-size: 10.43px;">terraform</a> <a href="/tags/threading/" style="font-size: 10px;">threading</a> <a href="/tags/typescript/" style="font-size: 13.04px;">typescript</a> <a href="/tags/utilities/" style="font-size: 18.7px;">utilities</a> <a href="/tags/validation/" style="font-size: 10.43px;">validation</a> <a href="/tags/virtualization/" style="font-size: 10.43px;">virtualization</a> <a href="/tags/web-api/" style="font-size: 15.65px;">web api</a> <a href="/tags/web-forms/" style="font-size: 10px;">web forms</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/wip/" style="font-size: 19.13px;">wip</a> <a href="/tags/wood-work/" style="font-size: 10.87px;">wood work</a> <a href="/tags/wordpress/" style="font-size: 10px;">wordpress</a> <a href="/tags/workers/" style="font-size: 11.3px;">workers</a> <a href="/tags/xamarin/" style="font-size: 10px;">xamarin</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
    </div>
  </div>

  
</aside>
        
      </div>
    </div>
  </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 Carl Paton |
      Powered by <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>





  
<script src="/js/search.js"></script>

  <script type="text/javascript">
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    searchFunc(path, "local-search-input", "local-search-result");
  </script>

</body>
</html>